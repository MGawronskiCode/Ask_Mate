{% extends 'base.html' %}

{% block title %}
    Question
{% endblock %}

{% block head %}

{% endblock %}

{% block body %}
    <h1>Question</h1>
    <h3>{{ question['title'] }}</h3>
    <p>{{ question['message'] }}</p>
    <img class="image" src="/static/{{ question.image }}" alt="" width=300>

    {% if session['username'] %}
        <p><a href="/question/{{ question.id }}/new-comment">Add comment</a></p>
    {% else %}
        <p><a href="{{ url_for('login_user') }}">Sign in to add comment</a></p>
    {% endif %}
    {% if question['id'] in session['added_by_user']['question'] %}
        <p><a href="/question/{{ question.id }}/edit">Edit question</a></p>
        <p><a href="/question/{{ question.id }}/delete">Delete question</a></p>
    {% endif %}

    <p>{% if tags %}
        tags:
        {% for tag in tags %}
            {{ tag }}
        {% endfor %}
    {% endif %}</p>
    {% if question['id'] in session['added_by_user']['question'] %}
        <p><a href="/question/{{ question.id }}/new-tag">Add new tag</a></p>
        <p><a href="/question/{{ question.id }}/delete-tag">Delete tag</a></p>
    {% endif %}
    <th><strong>
        Comment Section
    </strong></th>
    <br><br>
    <table>
        <th>SUBMISSION TIME</th>
        <th>MESSAGE</th>
        {% for comment in question_comments %}
            <tr>
            <td>{{ comment['submission_time'] }}</td>
            <td>{{ comment['message'] }}</td>
            {#            todo doesnt work if below (edit/delete link visible to all)#}
            {% if comment['id'] in session['added_by_user']['comment'] %}
                <td><a href="/comment/{{ comment['id'] }}/edit">edit</a></td>
                <td><a href="/comment/{{ comment['id'] }}/delete">delete</a></td>
            {% endif %}
        {% endfor %}
        </tr>
    </table>
    <br><br><br><br><br><br><br><br>
    <h2>Answers</h2>
    <table>
        {% for header in headers %}
            <th>{{ header.upper().replace('', ' ') }}</th>
        {% endfor %}
        {% for answer in answers %}
            <tr> {% for element in answer.values() %}
                {% if element == answer['vote_number'] %}
                    <td>
                        {{ element }}
                        <form action='/list/{{ question.id }}' method="POST">
                            {% if session['username'] %}
                                <button name="vote" value="upvote {{ answer['id'] }}">upvote</button>
                                <button name="vote" value="downvote {{ answer['id'] }}">downvote</button>
                            {% endif %}
                        </form>
                    </td>
                {% else %}
                    <td>{{ element }}</td>
                {% endif %}
            {% endfor %}
                {% if session['username'] %}
                    <td><a href="/answer/{{ answer['id'] }}/new-comment">Add comment</a></td>
                {% endif %}
                {% if answer['id'] in session['added_by_user']['answer'] %}
                    <td><a href="/answer/{{ answer['id'] }}/edit">Edit</a></td>
                    <td><a href="/answer/{{ answer['id'] }}/delete">Delete</a></td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
    <th><strong>
        Comments
    </strong></th>
    <br><br>
    <table>
        <th>SUBMISSION TIME</th>
        <th>MESSAGE</th>
        {% for comment in answer_comments %}
            <tr>
                <td>{{ comment['submission_time'] }}</td>
                <td>{{ comment['message'] }}</td>
                {% if comment['id'] in session['added_by_user']['comments'] %}
                    <td><a href="/comment/{{ comment['id'] }}/edit">edit</a></td>
                    <td><a href="/comment/{{ comment['id'] }}/delete">delete</a></td>
                {% endif %}
            </tr>
        {% endfor %}

    </table>

    {% if session['username'] %}
        <p><a href="/list/{{ question.id }}/new-answer">Add an answer</a></p>
    {% else %}
        <p><a href="{{ url_for('login_user') }}">Sign in to add new answer</a></p>
    {% endif %}
    <p><!--suppress HtmlUnknownTarget -->
        <a href="/list">Back to the questions list</a></p>
{% endblock %}

{% block footer %}

{% endblock %}